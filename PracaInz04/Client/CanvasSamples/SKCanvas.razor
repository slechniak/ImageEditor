@page "/skcanvas"

<h1>Raster (Bitmap) Canvas</h1>

<p>The canvas below is using pixels in memory. Click and drag to move the text.</p>

<div class="container-fluid text-center">
    <SKCanvasView
                @ref="skiaView" OnPaintSurface="OnPaintSurface" IgnorePixelScaling="true"
                @onpointerdown="OnPointerDown"
                @onpointermove="OnPointerMove"
                @onpointerup="OnPointerUp" class="border"/>
</div>

@*overrides width and height*@
@*<div class="container-fluid text-center">
    <SKCanvasView
                @ref="skiaView" OnPaintSurface="OnPaintSurface" IgnorePixelScaling="true"
                @onpointerdown="OnPointerDown"
                @onpointermove="OnPointerMove"
                @onpointerup="OnPointerUp" class="border" style="width: 400px; height:200px;"/>
</div>*@

@*canvas with attributes*@
@*<div class="container-fluid text-center">
    <SKCanvasView
                @ref="skiaView" OnPaintSurface="OnPaintSurface" IgnorePixelScaling="true"
                @onpointerdown="OnPointerDown"
                @onpointermove="OnPointerMove"
                @onpointerup="OnPointerUp" class="border" @attributes="CanvasAttributes"/>
</div>*@

@*<div class="container-fluid h-50 p-2 text-center">
    <SKCanvasView
                @ref="skiaView" OnPaintSurface="OnPaintSurface" IgnorePixelScaling="true"
                @onpointerdown="OnPointerDown"
                @onpointermove="OnPointerMove"
                @onpointerup="OnPointerUp" class="w-50 h-100 border"/>
</div>*@

@*<div class="container">
    <div class="row">
        <div class="col border rounded p-2 canvas-container text-center">

            <SKCanvasView
                @ref="skiaView" OnPaintSurface="OnPaintSurface" IgnorePixelScaling="true"
                @onpointerdown="OnPointerDown"
                @onpointermove="OnPointerMove"
                @onpointerup="OnPointerUp"/>

        </div>
    </div>
</div>*@

@code {
    SKCanvasView skiaView = null!;
    SKPoint? touchLocation;
    [Inject] IJSRuntime JS { get; set; } = null!;

    //private Dictionary<string, object> CanvasAttributes { get; set; } =
    //    new()
    //    {
    //        { "width", "400" },
    //        { "height", "200" }
    //    };

    void OnPaintSurface(SKPaintSurfaceEventArgs e)
    {
        // the the canvas and properties
        var canvas = e.Surface.Canvas;

        // make sure the canvas is blank
        canvas.Clear(SKColors.White);

        // decide what the text looks like
        using var paint = new SKPaint
        {
            Color = SKColors.Black,
            IsAntialias = true,
            Style = SKPaintStyle.Fill,
            TextAlign = SKTextAlign.Center,
            TextSize = 24
        };

        // adjust the location based on the pointer
        var coord = (touchLocation is SKPoint loc)
            ? new SKPoint(loc.X, loc.Y)
            : new SKPoint(e.Info.Width / 2, (e.Info.Height + paint.TextSize) / 2);

        // draw some text
        canvas.DrawText("SkiaSharp", coord, paint);
    }

    void OnPointerDown(PointerEventArgs e)
    {
        touchLocation = new SKPoint((float)e.OffsetX, (float)e.OffsetY);
        skiaView.Invalidate();
    }

    void OnPointerMove(PointerEventArgs e)
    {
        if (touchLocation == null)
            return;

        touchLocation = new SKPoint((float)e.OffsetX, (float)e.OffsetY);
        skiaView.Invalidate();
    }

    void OnPointerUp(PointerEventArgs e)
    {
        touchLocation = null;
        skiaView.Invalidate();
    }
}
